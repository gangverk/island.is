---
description: Next.js Server Actions Guidelines
globs: "**/*.{ts,tsx}"
---

# Next.js Server Actions Guidelines

This rule provides guidance on implementing server actions in Next.js.

<rule>
name: nextjs_server_actions
description: Standards for Next.js server actions implementation

filters:
  # Match any TypeScript files
  - type: file_extension
    pattern: "\\.(ts|tsx)$"

actions:
  - type: suggest
    message: |
      # Next.js Server Actions Guidelines

      ## Implementation with next-safe-action

      - Use next-safe-action for all server actions
      - Implement type-safe server actions with proper validation
      - Define input schemas using Zod for robust type checking
      - Handle errors gracefully and return appropriate responses
      - Use the ActionResponse type for consistent response handling

      ## Example Implementation

      ```typescript
      'use server'

      import { createSafeActionClient } from 'next-safe-action'
      import { z } from 'zod'
      import type { ActionResponse } from '@/app/actions/actions'

      const schema = z.object({
        value: z.string()
      })

      export const someAction = createSafeActionClient()
        .schema(schema)
        .action(async (input): Promise<ActionResponse> => {
          try {
            // Action logic here
            return { success: true, data: /* result */ }
          } catch (error) {
            return { 
              success: false, 
              error: error instanceof AppError ? error : appErrors.UNEXPECTED_ERROR 
            }
          }
        })
      ```

      ## Best Practices

      - Keep server actions in dedicated files with the 'use server' directive
      - Validate all inputs using Zod schemas
      - Return consistent response objects using ActionResponse type
      - Handle all potential errors and provide meaningful error messages
      - Use server actions for data mutations, not for data fetching
      - Implement proper error handling and validation
      - Test server actions thoroughly

metadata:
  priority: high
  version: 1.0
  tags: ["nextjs", "server-actions"]
</rule> 